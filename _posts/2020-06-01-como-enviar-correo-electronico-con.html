---
layout: post
title: Como enviar correo electronico con archivo adjunto en PHP
date: '2020-06-01T22:26:00.003+02:00'
author: David P.
tags:
- mail
- sendmail
- htmlentities()
- mail()
- php
- utf8_decode()
modified_time: '2020-06-01T22:30:03.963+02:00'
blogger_id: tag:blogger.com,1999:blog-3624480011084378437.post-6381919240563255825
blogger_orig_url: https://www.enfaseterminal.com/2020/06/como-enviar-correo-electronico-con.html
---

<div style="text-align: justify;">Como enviar un correo electrónico con archivos adjuntos con PHP 📨.&nbsp;</div><div style="text-align: justify;">Puede ser que necesitemos crear una función para enviar un correo electrónico con un archivo adjunto, como respuesta a un formulario o para realizar publicaciones en otros servidores.</div><div style="text-align: justify;">Si utilizamos una plataforma que en al que podemos programar y ejecutar PHP debemos asegurarnos que se encuentre instalado <a href="https://www.proofpoint.com/us/products/open-source-email-solution" target="_blank">sendmail</a>.&nbsp;</div><div style="text-align: justify;">Si somos el administrador de nuestro propio servidor, podremos instalarlo desde el terminal:</div><pre style="text-align: justify;">sudo apt-get install sendmail</pre>Si somos invitados en el servidor, lanzaremos un script para comprobar si podemos utilizar la función mail:<div><br /></div><div><pre style="text-align: left;">&lt;?php<br />&nbsp; &nbsp; ini_set( 'display_errors', 1 );<br />&nbsp; &nbsp; error_reporting( E_ALL );<span>&nbsp;&nbsp; &nbsp;//Comprobaremos si ha sido enviado o no</span><br />&nbsp; &nbsp; $from = "TU CORREO ELECTRONICO"; //La dirección de correo desde que la enviamos<br />&nbsp; &nbsp; $to = "DESTINATARIO";<span>&nbsp;&nbsp; &nbsp;//Dirección de correo a la que enviamos el mail</span><br />&nbsp; &nbsp; $subject = "Probando PHP mail";<span>&nbsp;&nbsp; &nbsp;//Encabezado del correo</span><br />&nbsp; &nbsp; $message = "PHP mail funciona correctamente";<span>&nbsp;&nbsp; &nbsp;//El mensaje</span><br />&nbsp; &nbsp; $headers = "From:" . $from;<span>&nbsp;&nbsp; &nbsp;//Cabecera que dejamos tal cual</span><br />&nbsp; &nbsp; mail($to,$subject,$message, $headers);<span>&nbsp;&nbsp; &nbsp;//Enviamos el correo</span><br />&nbsp; &nbsp; echo "The email message was sent.";<span>&nbsp;&nbsp; &nbsp;//Confirmamos que el correo ha sido enviado</span><br /><br />?&gt;</pre><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Si hemos recibido el correo, podremos continuar con la programación de nuestra función.</div><div style="text-align: justify;"><div><br /></div></div><div style="text-align: justify;"><br /></div><pre style="text-align: justify;">//Recipiente</pre><div style="text-align: justify;"><pre>$to = 'DESTINATARIO';&nbsp;<span>&nbsp; &nbsp; //A quien le enviamos nuestro correo</span></pre><pre><br />//remitente del correo<br /><pre>//Desde que correo le envamos y quien será el destinatario de la respuesta si lo hubiera</pre></pre><pre>$from = 'NUESTRO CORREO ELECTRONICO';<br />$fromName = 'UN NOMBRE, O NICK DESCRIPTIVO';<span>&nbsp; &nbsp; //Quienes somos o nuestra organización</span><br /><br /></pre><pre>//Asunto del email</pre><pre><pre>//Utilizamos la función utf8_decode() para que nos reconozca las tildes y la ñ, entre otros caracteres</pre>$subject = utf8_decode('ASUNTO DEL CORREO');&nbsp;</pre><pre><br /></pre><pre>//Ruta del archivo adjunto<br />$file = 'DIRECCIÓN GLOBAL DEL ARCHIVO QUE VAMOS A ENVIAR';<br /><br /></pre><pre>//Contenido del Email</pre><pre>//La función htmlentities() nos convertira las tildes ñ y caracteres especiales en etindades HTML<br />$htmlContent = htmlentities('CONTENIDO DEL CORREO CODIFICADO EN HTML');<span>&nbsp;</span></pre><pre><br /></pre><pre>//Encabezado para información del remitente<br />$headers = "De: $fromName"." &lt;".$from."&gt;";<br /><br /></pre><pre>//Limite Email<br />$semi_rand = md5(time());&nbsp;<br />$mime_boundary = "==Multipart_Boundary_x{$semi_rand}x";&nbsp;<br /><br /></pre><pre>//Encabezados para archivo adjunto&nbsp;<br />$headers .= "\n MIME-Version: 1.0 \n" . "Content-Type: multipart/mixed;\n" . " boundary=\"{$mime_boundary}\"";&nbsp;<br /><br /></pre><pre>//límite multiparte<br />$message = "--{$mime_boundary}\n" . "Content-Type: text/html; charset=\"UTF-8\"\n" .<br />"Content-Transfer-Encoding: 7bit\n\n" . $htmlContent . "\n\n";&nbsp;<br /><br /></pre><pre>//preparación de archivo<br />if(!empty($file) &gt; 0){<br />&nbsp; &nbsp; if(is_file($file)){<br />&nbsp; &nbsp; &nbsp; &nbsp; $message .= "--{$mime_boundary}\n";<br />&nbsp; &nbsp; &nbsp; &nbsp; $fp =&nbsp; &nbsp; @fopen($file,"rb");<br />&nbsp; &nbsp; &nbsp; &nbsp; $data =&nbsp; @fread($fp,filesize($file));<br />&nbsp; &nbsp; &nbsp; &nbsp; @fclose($fp);<br />&nbsp; &nbsp; &nbsp; &nbsp; $data = chunk_split(base64_encode($data));<br />&nbsp; &nbsp; &nbsp; &nbsp; $message .= "Content-Type: application/octet-stream; name=\"".basename($file)."\"\n" .&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; "Content-Description: ".basename($file)."\n" .<br />&nbsp; &nbsp; &nbsp; &nbsp; "Content-Disposition: attachment;\n" . " filename=\"".basename($file)."\"; size=".filesize($file).";\n" .&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; "Content-Transfer-Encoding: base64\n\n" . $data . "\n\n";<br />&nbsp; &nbsp; }<br />}<br />$message .= "--{$mime_boundary}--";<br />$returnpath = "-f" . $from;<br /><br /></pre><pre>//Enviar EMail<br />$mail = @mail($to, $subject, $message, $headers, $returnpath);&nbsp;</pre><pre><br /></pre>Esta función requiere mucho tiempo de ejecución y no es recomendable para el envio masivo de correos electronicos.<div><br /></div></div></div>