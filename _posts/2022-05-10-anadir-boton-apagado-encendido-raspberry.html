---
layout: post
title: Añadir botón apagado encendido Raspberry
date: '2022-05-10T21:23:00.005+02:00'
author: David P.
tags:
- formatear
- tarjeta SD
- Ubuntu Server
- import RPi.GPIO as GPIO
- stand-by
- 'rasModuleNotFoundError: No module named ''RPi'''
- servidor
- python
- raspberry
modified_time: '2022-05-10T21:23:54.538+02:00'
thumbnail: https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglXSfH5PehF-I9zDPqRmyXTmX_JTQNWYkuPWxCrppkONjft6xZJ_s-Kfvq8Abto7AteKSRmhQWckz2T8X4YZ9FUoENO0ggvibVThj7BqvLgSEEfiElb3JLV-mLcsJFDNOdQhF-KSZVky3F4-cMwePApsgfLsmOYj3OrJvD2ocMQyfBJki2vR-5Zwp1/s72-w249-c-h400/boton%20raspberry.jpg
blogger_id: tag:blogger.com,1999:blog-3624480011084378437.post-4588213571499172423
blogger_orig_url: https://www.enfaseterminal.com/2022/05/anadir-boton-apagado-encendido-raspberry.html
---

<p style="text-align: justify;">Raspberry es un pequeño ordenador, de bajo coste que podemos utilizar como PC&nbsp; de sobremesa o como servidor, sin necesidad de conectarle ningún periférico (pantalla, teclado, ratón). En este último caso, la labor de apagado solo es posible desconectando la corriente, con el consabido riesgo de pérdida de datos, y creamos archivos corruptos que impidan y/o dificulten su posterior encendido. También es posible que dañemos la tarjeta SD y debemos sustituirla o formatearla y volver a volcar el sistema operativos e instalar servicios que teníamos instalados y configurarlos otra vez.</p><p style="text-align: justify;">Una forma de evitar este tedioso proceso es incluir un botón de apagado, que también nos será válido para volver a encenderlo si lo dejamos en stand-by.</p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglXSfH5PehF-I9zDPqRmyXTmX_JTQNWYkuPWxCrppkONjft6xZJ_s-Kfvq8Abto7AteKSRmhQWckz2T8X4YZ9FUoENO0ggvibVThj7BqvLgSEEfiElb3JLV-mLcsJFDNOdQhF-KSZVky3F4-cMwePApsgfLsmOYj3OrJvD2ocMQyfBJki2vR-5Zwp1/s2201/boton%20raspberry.jpg" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="2201" data-original-width="1372" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglXSfH5PehF-I9zDPqRmyXTmX_JTQNWYkuPWxCrppkONjft6xZJ_s-Kfvq8Abto7AteKSRmhQWckz2T8X4YZ9FUoENO0ggvibVThj7BqvLgSEEfiElb3JLV-mLcsJFDNOdQhF-KSZVky3F4-cMwePApsgfLsmOYj3OrJvD2ocMQyfBJki2vR-5Zwp1/w249-h400/boton%20raspberry.jpg" width="249" /></a></div><br /><p>Para ello utilizaremos el interfaz I/O del que dispone la Raspberry</p><p><br /></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjz-aucPlw81tFT82Tvb3m3Wdh4G49jnZ3vVHl771VFXbI4Sh2TtX9AMZYy85w8nALkU066eYtRXC-4bMEzRPUtmye93-UjaRNw_0dgsvwks3-Z7zGlpXxyosJ-VHjbEW-f3QxKkpX2Z9L8hayi_QMY-R89qNcmhmn29YnGcX-66US5N9GEnSwVdXgT/s3208/Raspberry_Pi_2_Model_B_v1.1_top_new_(bg_cut_out).jpg" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="3208" data-original-width="2143" height="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjz-aucPlw81tFT82Tvb3m3Wdh4G49jnZ3vVHl771VFXbI4Sh2TtX9AMZYy85w8nALkU066eYtRXC-4bMEzRPUtmye93-UjaRNw_0dgsvwks3-Z7zGlpXxyosJ-VHjbEW-f3QxKkpX2Z9L8hayi_QMY-R89qNcmhmn29YnGcX-66US5N9GEnSwVdXgT/w429-h640/Raspberry_Pi_2_Model_B_v1.1_top_new_(bg_cut_out).jpg" width="429" /></a></div><br /><p>El interfaz GPIO dispone de unos terminal macho numerados. Disponiendo las Raspberry en esta posición su disposición sera de izquierda a derecha y de arriba abajo empezando del 1 al 40</p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi-XNvZGFrRqStECAR2289mqinT2LFQpZ3fCSeLt1rO46y58cJzzOk_TDS4UN8MfKuPDvImT140O5M6ZK312X18bwU3K_PX7otb_RMU8mRmRwsSdjCrmT5w1eI7s_3c-o4tQdoHcKyG3Khwhqk3870A1eb-vWOkm2Tn0KOexO_g9T8IT0P87yhLWa1M/s700/gpio%20numeracion.jpg" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="400" data-original-width="700" height="366" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi-XNvZGFrRqStECAR2289mqinT2LFQpZ3fCSeLt1rO46y58cJzzOk_TDS4UN8MfKuPDvImT140O5M6ZK312X18bwU3K_PX7otb_RMU8mRmRwsSdjCrmT5w1eI7s_3c-o4tQdoHcKyG3Khwhqk3870A1eb-vWOkm2Tn0KOexO_g9T8IT0P87yhLWa1M/w640-h366/gpio%20numeracion.jpg" width="640" /></a></div><br /><p>En nuestro caso utilizaremos los pines 4 y 6 donde colocaremos nuestro botón para realizar el apagado de nuestro pequeño ordenador.&nbsp;</p><p>Realizaremos un pequeño bricolaje. La manera más sencilla sería con la utilización de dos cables que en una de sus puntas se encuentran una punteras hembras aisladas y en la otra punta de los cables soldar un pequeño pulsador. También podremos utilizar una placa de pruebas para, más adelante poder ampliar nuestros proyectos.</p><p><br /></p><p>Dependendiendo del sistema operativo que utilicemos, es posible que tengamos que realizar la instalación de ciertas librerías para que los scripts de Python funcionen correctamente</p><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px; text-align: left;"><b><span style="color: #ffa400;">sudo apt-get install python-is-python3</span></b></blockquote><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px;"><p style="text-align: left;"><span style="color: #ffa400;"><b>sudo apt-get -y install python3-rpi.gpio</b></span></p></blockquote><p>Los siguientes scripts que manejan los eventos provocados por la pulsación del botón colocado entre el pin 5 y 6 han sido copiados de la página&nbsp;</p><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px;"><p style="text-align: left;"><a href="https://soloelectronicos.com/2018/10/18/como-agregar-un-boton-de-encendido-apagado-a-la-raspberry-pi/" target="_blank">Soloelectronicos.com</a></p></blockquote><p>&nbsp;Crearemos un archivo ejecutable para Python que llamaremos&nbsp;listen-for-shutdown.py</p><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px;"><p style="text-align: left;"><span style="color: #ffa400;"><b>sudo nano listen-for-shutdown.py</b></span></p></blockquote><p>Copiaremos el siguiente script el archivo que hemos creado y guardaremos su contenido</p><p><br /></p><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px;"><p><b><span style="color: #ffa400;">#!/usr/bin/env python</span></b></p><p><b><span style="color: #ffa400;"><br /></span></b></p><p><b><span style="color: #ffa400;">import RPi.GPIO as GPIO</span></b></p><p><b><span style="color: #ffa400;">import subprocess</span></b></p><p><b><span style="color: #ffa400;"><br /></span></b></p><p><b><span style="color: #ffa400;"><br /></span></b></p><p><b><span style="color: #ffa400;">GPIO.setmode(GPIO.BCM)</span></b></p><p><b><span style="color: #ffa400;">GPIO.setup(3, GPIO.IN, pull_up_down=GPIO.PUD_UP)</span></b></p><p><b><span style="color: #ffa400;">GPIO.wait_for_edge(3, GPIO.FALLING)</span></b></p><p><b><span style="color: #ffa400;"><br /></span></b></p><p><b><span style="color: #ffa400;">subprocess.call(['shutdown', '-h', 'now'], shell=False)</span></b></p></blockquote><p>&nbsp;</p><p></p><div class="separator" style="clear: both; text-align: justify;">Seguidamente moveremos el archivo a la carpeta&nbsp;<a href="https://www.enfaseterminal.com/search?q=%2Fusr%2Flocal%2Fbin%2F" target="_blank">/usr/local/bin/</a></div><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px;"><div class="separator" style="clear: both; text-align: justify;"><br /></div></blockquote><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px; text-align: left;"><b><span style="color: #ffa400;">sudo mv listen-for-shutdown.py /usr/local/bin/</span></b></blockquote><p>Y le daremos atributos de ejecución</p><blockquote style="border: none; margin: 0 0 0 40px; padding: 0px;"><p style="text-align: left;"><b><span style="color: #ffa400;">sudo chmod +x /usr/local/bin/listen-for-shutdown.py</span></b></p></blockquote><p style="text-align: justify;">Si tenemos nuestra Raspberry en stand-by, bien por que la hemos apagado desde la línea de comandos o desde nuestro botón de apagado. También es posible encenderlo desde el mismo botón, para ello crearemos un nuevo archivo.&nbsp;</p><blockquote style="border: none; margin: 0 0 0 40px; padding: 0px;"><p style="text-align: left;"><b><span style="color: #ffa400;">sudo nano listen-for-shutdown.sh</span></b></p></blockquote><p>Y copiaremos y guardaremos el siguiente código:</p><p><br /></p><blockquote style="border: none; margin: 0 0 0 40px; padding: 0px;"><p style="text-align: left;">&nbsp;<span style="color: #ffa400;"><b>#! /bin/sh</b></span></p><p><span style="color: #ffa400;"><b><br /></b></span></p><p><span style="color: #ffa400;"><b>### BEGIN INIT INFO</b></span></p><p><span style="color: #ffa400;"><b># Provides:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; listen-for-shutdown.py</b></span></p><p><span style="color: #ffa400;"><b># Required-Start:&nbsp; &nbsp; $remote_fs $syslog</b></span></p><p><span style="color: #ffa400;"><b># Required-Stop:&nbsp; &nbsp; &nbsp;$remote_fs $syslog</b></span></p><p><span style="color: #ffa400;"><b># Default-Start:&nbsp; &nbsp; &nbsp;2 3 4 5</b></span></p><p><span style="color: #ffa400;"><b># Default-Stop:&nbsp; &nbsp; &nbsp; 0 1 6</b></span></p><p><span style="color: #ffa400;"><b>### END INIT INFO</b></span></p><p><span style="color: #ffa400;"><b><br /></b></span></p><p><span style="color: #ffa400;"><b># If you want a command to always run, put it here</b></span></p><p><span style="color: #ffa400;"><b><br /></b></span></p><p><span style="color: #ffa400;"><b># Carry out specific functions when asked to by the system</b></span></p><p><span style="color: #ffa400;"><b>case "$1" in</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; start)</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; &nbsp; echo "Starting listen-for-shutdown.py"</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; &nbsp; /usr/local/bin/listen-for-shutdown.py &amp;</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; &nbsp; ;;</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; stop)</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; &nbsp; echo "Stopping listen-for-shutdown.py"</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; &nbsp; pkill -f /usr/local/bin/listen-for-shutdown.py</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; &nbsp; ;;</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; *)</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; &nbsp; echo "Usage: /etc/init.d/listen-for-shutdown.sh {start|stop}"</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; &nbsp; exit 1</b></span></p><p><span style="color: #ffa400;"><b>&nbsp; &nbsp; ;;</b></span></p><p><span style="color: #ffa400;"><b>esac</b></span></p><p><span style="color: #ffa400;"><b><br /></b></span></p><p><span style="color: #ffa400;"><b>exit 0</b></span></p></blockquote><p>&nbsp;</p><p>Una vez guardado moveremos el archivo a la carpeta&nbsp;&nbsp;<a href="https://www.enfaseterminal.com/search?q=%2Fetc%2Finit.d%2F" target="_blank">/etc/init.d/</a></p><blockquote style="border: none; margin: 0 0 0 40px; padding: 0px;"><p style="text-align: left;"><span style="color: #ffa400;"><b>sudo mv listen-for-shutdown.sh /etc/init.d/</b></span></p></blockquote><p>Y le concederemos privilegios de ejecución:</p><blockquote style="border: none; margin: 0 0 0 40px; padding: 0px;"><p style="text-align: left;"><span style="color: #ffa400;"><b>&nbsp;sudo chmod +x /etc/init.d/listen-for-shutdown.sh</b></span></p></blockquote><p>Ahora registramos la secuencia de comandos para ejecutar en el arranque y le pasaremos el parámetros de arranque con los dos siguientes comandos.</p><blockquote style="border: none; margin: 0 0 0 40px; padding: 0px;"><p><span style="color: #ffa400;"><b>sudo update-rc.d listen-for-shutdown.sh defaults</b></span></p><p><span style="color: #ffa400;"><b>sudo /etc/init.d/listen-for-shutdown.sh start</b></span></p></blockquote><p style="text-align: justify;">En mi caso tenia instalado Ubuntu Server como sistema operativo. Y es posible que al ejecutar el script te aparezcan uno o varios mensajes de error. Si es asi te dejo los articulos que publique para solucionarlos, y que vuestro botón de apagado funcione correctamente.</p><blockquote style="border: none; margin: 0 0 0 40px; padding: 0px;"><p style="text-align: left;"><a href="https://www.enfaseterminal.com/2022/04/mensaje-de-error-usrbinenv-python-no.html" target="_blank">Mensaje de error /usr/bin/env: ‘python’: No such file or directory</a></p></blockquote><blockquote style="border: none; margin: 0 0 0 40px; padding: 0px;"><p style="text-align: left;"><a href="https://www.enfaseterminal.com/2022/04/mensaje-de-error-import-rpigpio-as-gpio.html" target="_blank">Mensaje de error import RPi.GPIO as GPIO ModuleNotFoundError: No module named 'RPi'</a></p></blockquote><p><br /></p>